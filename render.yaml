services:
  - type: web
    name: clgbooks-ai
    env: node
    region: oregon
    plan: free
    
    # Build configuration
    buildCommand: npm install && npm run build
    startCommand: npm start
    
    # Environment variables
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: clgbooks-db
          property: connectionString
      - key: SESSION_SECRET
        generateValue: true
    
    # Auto-deploy from Git
    autoDeployOnPush: true
    branch: main
    
    # Health check
    healthCheckPath: /api/auth/me
    
    # Disk size
    disk:
      name: uploads
      mountPath: /app/uploads
      sizeGB: 1

# Database configuration
databases:
  - name: clgbooks-db
    engine: postgres
    version: '15'
    ipAllowList: []  # Allow from anywhere
